import{r as h,S as Y,j as e,t as m,f as l,i as J}from"./index-PLDaagTA.js";import{u as $,d as _,l as K,f as ee,g as se}from"./Layout-XD39IB8x.js";import{C as U}from"./CouponServices-0CD9yxjP.js";import{u as le}from"./useAsync-frAQ4t-E.js";import{T as R,D as ae,u as Q,M as W}from"./DrawerButton-DwQOXQlS.js";import{u as te}from"./useFilter-BFXugzkf.js";import{P as re}from"./PageTitle-DoOTr-E6.js";import{D as X}from"./DeleteModal-BuBHmZHf.js";import{B as ie}from"./BulkActionDrawer-B5uwEcKc.js";import{u as ne,E as I}from"./index.esm-CS4zo5jb.js";import{I as H}from"./InputArea-iBDtlSiU.js";import{I as O}from"./InputValue-Dx3PMu3m.js";import{L as D}from"./LabelArea-DC4hSjvs.js";import{U as de}from"./Uploader-D0X8AV43.js";import{n as q,a as z}from"./toast-DhrUUM-V.js";import{u as oe}from"./useTranslationValue-BxGSnvDP.js";import{S as me}from"./SwitchToggle-BXv17vg8.js";import{a as ce}from"./index.prod-xminSE24.js";import{T as xe}from"./TableLoading-BIzq2BWk.js";import{C as Z,E as ge}from"./EditDeleteButton-jztksUNk.js";import{S as pe}from"./ShowHideButton-UWQwP7b2.js";import{N as ue}from"./NotFound-Z5WVCT-B.js";import"./exportFromJSON-fDIoOtpr.js";import{A as he}from"./AnimatedContent-BfEynzY3.js";import"./iconBase-DFE9nSFk.js";import"./SelectLanguageTwo-B8pttvxA.js";import"./spinner-CkndCogW.js";import"./browser-BYFnD1zY.js";import"./index-CP4Dvlba.js";import"./useDisableForDemo-DjtHBIR8.js";import"./ProductServices-Cz4MygcK.js";import"./CurrencyServices-BlJ4lGlV.js";import"./AdminServices-DOFZR09-.js";import"./Tree-6vvdrwOw.js";import"./_commonjs-dynamic-modules-LM44EJN2.js";import"./Tooltip-DmGlEDOP.js";const je=a=>{const{isDrawerOpen:r,closeDrawer:j,setIsUpdate:i,lang:d}=h.useContext(Y),[y,b]=h.useState(""),[g,C]=h.useState("en"),[c,p]=h.useState({}),[u,w]=h.useState(!1),[v,s]=h.useState(!1),[f,x]=h.useState(!1),{currency:N}=$(),{handlerTextTranslateHandler:S}=oe(),{register:F,handleSubmit:E,setValue:n,clearErrors:A,formState:{errors:M}}=ne(),B=async o=>{var k,P;console.log("coupon data",o);try{x(!0);const t={title:{...await S(o.title,g,c==null?void 0:c.title),[g]:o.title},couponCode:o.couponCode,endTime:o.endTime,minimumAmount:o.minimumAmount,logo:y,lang:g,status:u?"show":"hide",discountType:{type:v?"percentage":"fixed",value:o.discountPercentage},productType:o.productType};return}catch(T){q(((P=(k=T==null?void 0:T.response)==null?void 0:k.data)==null?void 0:P.message)||(T==null?void 0:T.message)),x(!1),j()}},L=o=>{C(o),Object.keys(c).length>0&&n("title",c.title[o||"en"])};return h.useEffect(()=>{if(!r){p({}),n("title"),n("productType"),n("couponCode"),n("endTime"),n("discountPercentage"),n("minimumAmount"),b(""),A("title"),A("productType"),A("couponCode"),A("endTime"),A("discountPercentage"),A("minimumAmount"),C(d),n("language",g);return}a&&(async()=>{var o,k,P,T;try{const t=await U.getCouponById(a);t&&(p(t),n("title",t.title[g||"en"]),n("productType",t.productType),n("couponCode",t.couponCode),n("endTime",_(t.endTime).format("YYYY-MM-DD HH:mm")),n("discountPercentage",(o=t.discountType)==null?void 0:o.value),n("minimumAmount",t.minimumAmount),w(t.status==="show"),s(((k=t.discountType)==null?void 0:k.type)==="percentage"),b(t.logo))}catch(t){q(((T=(P=t==null?void 0:t.response)==null?void 0:P.data)==null?void 0:T.message)||(t==null?void 0:t.message))}})()},[a,n,r,A,g,d]),{register:F,handleSubmit:E,onSubmit:B,errors:M,setImageUrl:b,imageUrl:y,published:u,setPublished:w,currency:N,discountType:v,isSubmitting:f,setDiscountType:s,handleSelectLanguage:L}},be=({title:a,handleProcess:r,processOption:j,product:i,handleIsCombination:d})=>e.jsx(e.Fragment,{children:e.jsx("div",{className:`${i?"mb-3 flex flex-wrap justify-end items-center mr-8":"mb-3"}`,children:e.jsxs("div",{className:"flex flex-wrap items-center",children:[i?e.jsx("label",{className:"block text-base font-normal text-orange-500 dark:text-orange-400 mx-4",children:"Does this product have variants?"}):e.jsx("label",{className:"block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-1",children:a}),e.jsx(ce,{onChange:i?d:r,checked:j,className:"react-switch",uncheckedIcon:e.jsx("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",height:"100%",fontSize:14,color:"white",paddingRight:45,paddingTop:1},children:"Fixed"}),width:125,height:33,handleDiameter:28,offColor:"#E53E3E",onColor:"#2F855A",checkedIcon:e.jsx("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",height:"100%",fontSize:14,color:"white",paddingLeft:50,paddingTop:1},children:"Percentage"})})]})})}),G=({id:a})=>{const{register:r,handleSubmit:j,onSubmit:i,errors:d,setImageUrl:y,imageUrl:b,published:g,setPublished:C,currency:c,discountType:p,setDiscountType:u,isSubmitting:w,handleSelectLanguage:v}=je(a);return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-full relative  p-6 border-b border-gray-100 bg-gray-50 dark:border-gray-700 dark:bg-gray-800 dark:text-gray-300 ",children:a?e.jsx(R,{register:r,handleSelectLanguage:v,title:m("UpdateCoupon"),description:m("UpdateCouponDescription")}):e.jsx(R,{register:r,handleSelectLanguage:v,title:m("AddCoupon"),description:m("AddCouponDescription")})}),e.jsx(K.Scrollbars,{className:"w-full md:w-7/12 lg:w-8/12 xl:w-8/12 relative dark:bg-gray-700 dark:text-gray-200",children:e.jsxs("form",{onSubmit:j(i),children:[e.jsxs("div",{className:"px-6 pt-8 flex-grow scrollbar-hide w-full max-h-full pb-40",children:[e.jsxs("div",{className:"grid grid-cols-6 gap-3 md:gap-5 xl:gap-6 lg:gap-6 mb-6",children:[e.jsx(D,{label:m("CouponBannerImage")}),e.jsx("div",{className:"col-span-8 sm:col-span-4",children:e.jsx(de,{imageUrl:b,setImageUrl:y,folder:"coupon",targetWidth:238,targetHeight:238})})]}),e.jsxs("div",{className:"grid grid-cols-6 gap-3 md:gap-5 xl:gap-6 lg:gap-6 mb-6",children:[e.jsx(D,{label:m("CampaignName")}),e.jsxs("div",{className:"col-span-8 sm:col-span-4",children:[e.jsx(H,{required:!0,register:r,label:"Coupon title",name:"title",type:"text",placeholder:m("CampaignName")}),e.jsx(I,{errorName:d.title})]})]}),e.jsxs("div",{className:"grid grid-cols-6 gap-3 md:gap-5 xl:gap-6 lg:gap-6 mb-6",children:[e.jsx(D,{label:m("CampaignCode")}),e.jsxs("div",{className:"col-span-8 sm:col-span-4",children:[e.jsx(H,{required:!0,register:r,label:"Coupon Code",name:"couponCode",type:"text",placeholder:m("CampaignCode")}),e.jsx(I,{errorName:d.couponCode})]})]}),e.jsxs("div",{className:"grid grid-cols-6 gap-3 md:gap-5 xl:gap-6 lg:gap-6 mb-6",children:[e.jsx(D,{label:m("CouponValidityTime")}),e.jsxs("div",{className:"col-span-8 sm:col-span-4",children:[e.jsx(l.Input,{...r("endTime",{required:"Coupon Validation End Time"}),label:"Coupon Validation End Time",name:"endTime",type:"datetime-local",placeholder:m("CouponValidityTime")}),e.jsx(I,{errorName:d.endTime})]})]}),e.jsxs("div",{className:"grid grid-cols-6 gap-3 md:gap-5 xl:gap-6 lg:gap-6 mb-6",children:[e.jsx(D,{label:m("DiscountType")}),e.jsxs("div",{className:"col-span-8 sm:col-span-4",children:[e.jsx(be,{handleProcess:u,processOption:p}),e.jsx(I,{errorName:d.discountType})]})]}),e.jsxs("div",{className:"grid grid-cols-6 gap-3 md:gap-5 xl:gap-6 lg:gap-6 mb-6",children:[e.jsx(D,{label:m("Discount")}),e.jsxs("div",{className:"col-span-8 sm:col-span-4",children:[e.jsx(O,{product:!0,required:!0,register:r,maxValue:p?99:1e3,minValue:1,label:"Discount",name:"discountPercentage",type:"number",placeholder:p?"Percentage":"Fixed Amount",currency:p?"%":c}),e.jsx(I,{errorName:d.discountPercentage})]})]}),e.jsxs("div",{className:"grid grid-cols-6 gap-3 md:gap-5 xl:gap-6 lg:gap-6 mb-6",children:[e.jsx(D,{label:m("MinimumAmount")}),e.jsxs("div",{className:"col-span-8 sm:col-span-4",children:[e.jsx(O,{product:!0,required:!0,register:r,maxValue:2e5,minValue:100,label:"Minimum Amount",name:"minimumAmount",type:"number",placeholder:m("MinimumAmountPlasholder"),currency:c}),e.jsx(I,{errorName:d.minimumAmount})]})]}),e.jsxs("div",{className:"grid grid-cols-6 gap-3 md:gap-5 xl:gap-6 lg:gap-6 mb-6",children:[e.jsx(D,{label:m("Published")}),e.jsxs("div",{className:"col-span-8 sm:col-span-4",children:[e.jsx(me,{handleProcess:C,processOption:g}),e.jsx(I,{errorName:d.productType})]})]})]}),e.jsx(ae,{id:a,title:"Coupon",isSubmitting:w})]})})]})},fe=({isCheck:a,coupons:r,setIsCheck:j})=>{const[i,d]=h.useState([]),{title:y,serviceId:b,handleModalOpen:g,handleUpdate:C}=Q(),{currency:c,showDateFormat:p,globalSetting:u,showingTranslateValue:w}=$(),v=s=>{const{id:f,checked:x}=s.target;j([...a,f]),x||j(a.filter(N=>N!==f))};return h.useEffect(()=>{const s=r==null?void 0:r.map(f=>{const x=new Date(f==null?void 0:f.updatedAt).toLocaleString("en-US",{timeZone:u==null?void 0:u.default_time_zone});return{...f,updatedDate:x}});d(s)},[r,u==null?void 0:u.default_time_zone]),e.jsxs(e.Fragment,{children:[a.length<1&&e.jsx(X,{id:b,title:y}),a.length<2&&e.jsx(W,{children:e.jsx(G,{id:b})}),e.jsx(l.TableBody,{children:i==null?void 0:i.map((s,f)=>{var x,N,S,F,E;return e.jsxs(l.TableRow,{children:[e.jsx(l.TableCell,{children:e.jsx(Z,{type:"checkbox",name:(x=s==null?void 0:s.title)==null?void 0:x.en,id:s._id,handleClick:v,isChecked:a==null?void 0:a.includes(s._id)})}),e.jsxs(l.TableCell,{children:[e.jsxs("div",{className:"flex items-center",children:[s!=null&&s.logo?e.jsx(l.Avatar,{className:"hidden p-1 mr-2 md:block bg-gray-50 shadow-none",src:s==null?void 0:s.logo,alt:"product"}):e.jsx(l.Avatar,{src:"https://res.cloudinary.com/ahossain/image/upload/v1655097002/placeholder_kvepfp.png",alt:"product"}),e.jsxs("div",{children:[e.jsx("span",{className:"text-sm",children:w(s==null?void 0:s.title)})," "]})]})," "]}),e.jsxs(l.TableCell,{children:[" ",e.jsxs("span",{className:"text-sm",children:[" ",s.couponCode]})," "]}),(N=s==null?void 0:s.discountType)!=null&&N.type?e.jsxs(l.TableCell,{children:[" ",e.jsxs("span",{className:"text-sm font-semibold",children:[" ",((S=s==null?void 0:s.discountType)==null?void 0:S.type)==="percentage"?`${(F=s==null?void 0:s.discountType)==null?void 0:F.value}%`:`${c}${(E=s==null?void 0:s.discountType)==null?void 0:E.value}`]})," "]}):e.jsxs(l.TableCell,{children:[" ",e.jsx("span",{className:"text-sm font-semibold",children:" "})," "]}),e.jsx(l.TableCell,{className:"text-center",children:e.jsx(pe,{id:s._id,status:s.status})}),e.jsx(l.TableCell,{children:e.jsx("span",{className:"text-sm",children:p(s.startTime)})}),e.jsx(l.TableCell,{children:e.jsx("span",{className:"text-sm",children:p(s.endTime)})}),e.jsx(l.TableCell,{className:"align-middle ",children:_().isAfter(_(s.endTime))?e.jsx(l.Badge,{type:"danger",children:"Expired"}):e.jsx(l.Badge,{type:"success",children:"Active"})}),e.jsx(l.TableCell,{children:e.jsx(ge,{id:s==null?void 0:s._id,isCheck:a,handleUpdate:C,handleModalOpen:g,title:w(s==null?void 0:s.title)})})]},f+1)})})]})},ls=()=>{const{t:a}=J(),{toggleDrawer:r,lang:j}=h.useContext(Y),{data:i,loading:d,error:y}=le(U.getAllCoupons),[b,g]=h.useState(!1),[C,c]=h.useState([]),{allId:p,serviceId:u,handleDeleteMany:w,handleUpdateMany:v}=Q(),{filename:s,isDisabled:f,couponRef:x,dataTable:N,serviceData:S,totalResults:F,resultsPerPage:E,handleChangePage:n,handleSelectFile:A,setSearchCoupon:M,handleSubmitCoupon:B,handleUploadMultiple:L,handleRemoveSelectFile:o}=te(i),k=()=>{g(!b),c(i==null?void 0:i.map(T=>T._id)),b&&c([])},P=()=>{M(""),x.current.value=""};return e.jsxs(e.Fragment,{children:[e.jsx(re,{children:a("Quản lý Coupons")}),e.jsx(X,{ids:p,setIsCheck:c,title:"Selected Coupon"}),e.jsx(ie,{ids:p,title:"Coupons"}),e.jsx(W,{children:e.jsx(G,{id:u})}),e.jsxs(he,{children:[e.jsx(l.Card,{className:"w-full shadow-xs overflow-hidden bg-white dark:bg-gray-800 mb-5",children:e.jsx(l.CardBody,{children:e.jsxs("form",{onSubmit:B,className:"py-3 md:pb-0 grid gap-4 lg:gap-6 xl:gap-6 xl:flex",children:[e.jsx("div",{className:"flex-grow-0 sm:flex-grow md:flex-grow lg:flex-grow xl:flex-grow"}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[e.jsx("div",{className:"flex-grow-0 md:flex-grow lg:flex-grow xl:flex-grow",children:e.jsxs(l.Button,{disabled:C.length<1,onClick:()=>w(C),className:"w-full rounded-md h-12 bg-red-300 disabled btn-red",children:[e.jsx("span",{className:"mr-2",children:e.jsx(ee,{})}),a("Xóa coupons")]})}),e.jsx("div",{className:"flex-grow-0 md:flex-grow lg:flex-grow xl:flex-grow",children:e.jsxs(l.Button,{onClick:r,className:"w-full rounded-md h-12",children:[e.jsx("span",{className:"mr-2",children:e.jsx(se,{})}),a("Thêm coupon")]})})]})]})})}),e.jsx(l.Card,{className:"min-w-0 shadow-xs overflow-hidden bg-white dark:bg-gray-800 mb-5",children:e.jsx(l.CardBody,{children:e.jsxs("form",{onSubmit:B,className:"py-3 grid gap-4 lg:gap-6 xl:gap-6 md:flex xl:flex",children:[e.jsx("div",{className:"flex-grow-0 md:flex-grow lg:flex-grow xl:flex-grow",children:e.jsx(l.Input,{ref:x,type:"search",placeholder:a("Nhập tên coupon")})}),e.jsxs("div",{className:"flex items-center gap-2 flex-grow-0 md:flex-grow lg:flex-grow xl:flex-grow",children:[e.jsx("div",{className:"w-full mx-1",children:e.jsx(l.Button,{type:"submit",className:"h-12 w-full bg-emerald-700",children:"Áp dụng"})}),e.jsx("div",{className:"w-full mx-1",children:e.jsx(l.Button,{layout:"outline",onClick:P,type:"reset",className:"px-4 md:py-1 py-2 h-12 text-sm dark:bg-gray-700",children:e.jsx("span",{className:"text-black dark:text-gray-200",children:"Hoàn tác"})})})]})]})})})]}),d?e.jsx(xe,{row:12,col:8,width:140,height:20}):y?e.jsx("span",{className:"text-center mx-auto text-red-500",children:y}):(S==null?void 0:S.length)!==0?e.jsxs(l.TableContainer,{className:"mb-8",children:[e.jsxs(l.Table,{children:[e.jsx(l.TableHeader,{children:e.jsxs("tr",{children:[e.jsx(l.TableCell,{children:e.jsx(Z,{type:"checkbox",name:"selectAll",id:"selectAll",handleClick:k,isChecked:b})}),e.jsx(l.TableCell,{children:a("CoupTblCampaignsName")}),e.jsx(l.TableCell,{children:a("CoupTblCode")}),e.jsx(l.TableCell,{children:a("Discount")}),e.jsx(l.TableCell,{className:"text-center",children:a("catPublishedTbl")}),e.jsx(l.TableCell,{children:a("CoupTblStartDate")}),e.jsx(l.TableCell,{children:a("CoupTblEndDate")}),e.jsx(l.TableCell,{children:a("CoupTblStatus")}),e.jsx(l.TableCell,{className:"text-right",children:a("CoupTblActions")})]})}),e.jsx(fe,{lang:j,isCheck:C,coupons:N,setIsCheck:c})]}),e.jsx(l.TableFooter,{children:e.jsx(l.Pagination,{totalResults:F,resultsPerPage:E,onChange:n,label:"Table navigation"})})]}):e.jsx(ue,{title:"Sorry, There are no coupons right now."})]})};export{ls as default};
