import{r as o,S as M,i as F,j as e,f as s,t as v,e as Y,A as X}from"./index-PLDaagTA.js";import{l as P,e as G,u as J,d as K,i as W,g as ee}from"./Layout-XD39IB8x.js";import{u as O}from"./useAsync-frAQ4t-E.js";import{T as z,D as _,u as se,M as Z}from"./DrawerButton-DwQOXQlS.js";import{L as k}from"./LabelArea-DC4hSjvs.js";import{u as H,E as C}from"./index.esm-CS4zo5jb.js";import{A as T}from"./AdminServices-DOFZR09-.js";import{n as A,a as D}from"./toast-DhrUUM-V.js";import{I as B}from"./InputArea-iBDtlSiU.js";import{T as le}from"./TableLoading-BIzq2BWk.js";import{T as R}from"./Tooltip-DmGlEDOP.js";import{D as ae}from"./DeleteModal-BuBHmZHf.js";import{M as te,a as re,U as ne}from"./UserStatusServices-CyrzkJQt.js";import{s as oe}from"./spinner-CkndCogW.js";import{N as ie}from"./NotFound-Z5WVCT-B.js";import{P as ce}from"./PageTitle-DoOTr-E6.js";import{A as de}from"./AnimatedContent-BfEynzY3.js";import"./iconBase-DFE9nSFk.js";import"./SelectLanguageTwo-B8pttvxA.js";import"./ProductServices-Cz4MygcK.js";import"./CouponServices-0CD9yxjP.js";import"./CurrencyServices-BlJ4lGlV.js";import"./useDisableForDemo-DjtHBIR8.js";const me=()=>{const[t,l]=o.useState([]),[n,i]=o.useState(!1),[c,d]=o.useState(!1),{closeDrawer:u,setIsUpdate:p}=o.useContext(M),{register:r,handleSubmit:j,setValue:y,formState:{errors:h}}=H();return o.useEffect(()=>{i(!0),T.getAllRoles().then(a=>{a._embedded&&a._embedded.role&&l(a._embedded.role),i(!1)}).catch(a=>{var w,g;A(((g=(w=a==null?void 0:a.response)==null?void 0:w.data)==null?void 0:g.message)||"Lỗi khi lấy danh sách quyền"),i(!1)})},[]),{register:r,handleSubmit:j,onSubmit:async a=>{var w,g;try{d(!0);const m={fullName:a.fullName,email:a.email,password:a.password,role:a.role},N=await T.createUser(m);D(N.message||"Tạo người dùng thành công"),p(!0),u(),d(!1)}catch(m){A(((g=(w=m==null?void 0:m.response)==null?void 0:w.data)==null?void 0:g.message)||"Lỗi khi tạo người dùng"),d(!1)}},errors:h,roles:t,loading:n,isSubmitting:c}},xe=()=>{const{t}=F(),{register:l,handleSubmit:n,onSubmit:i,errors:c,roles:d,loading:u,isSubmitting:p}=me();return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-full relative p-6 border-b border-gray-100 bg-gray-50 dark:border-gray-700 dark:bg-gray-800 dark:text-gray-300",children:e.jsx(z,{title:t("Thêm nhân viên mới"),description:t("Thêm người dùng mới với quyền nhân viên hoặc admin")})}),e.jsx(P.Scrollbars,{className:"w-full md:w-7/12 lg:w-8/12 xl:w-8/12 relative dark:bg-gray-700 dark:text-gray-200",children:e.jsx(s.Card,{className:"overflow-y-scroll flex-grow scrollbar-hide w-full max-h-full",children:e.jsx(s.CardBody,{children:e.jsxs("form",{onSubmit:n(i),children:[e.jsxs("div",{className:"px-6 pt-8 flex-grow scrollbar-hide w-full max-h-full pb-40",children:[e.jsxs("div",{className:"grid grid-cols-6 gap-3 md:gap-5 xl:gap-6 lg:gap-6 mb-6",children:[e.jsx(k,{label:t("Họ tên")}),e.jsxs("div",{className:"col-span-8 sm:col-span-4",children:[e.jsx(B,{register:l,label:"Họ tên",name:"fullName",type:"text",placeholder:"Nhập họ tên người dùng",required:!0}),e.jsx(C,{errorName:c.fullName})]})]}),e.jsxs("div",{className:"grid grid-cols-6 gap-3 md:gap-5 xl:gap-6 lg:gap-6 mb-6",children:[e.jsx(k,{label:t("Email")}),e.jsxs("div",{className:"col-span-8 sm:col-span-4",children:[e.jsx(B,{register:l,label:"Email",name:"email",type:"email",placeholder:"email@example.com",required:!0,pattern:/^[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/}),e.jsx(C,{errorName:c.email})]})]}),e.jsxs("div",{className:"grid grid-cols-6 gap-3 md:gap-5 xl:gap-6 lg:gap-6 mb-6",children:[e.jsx(k,{label:t("Mật khẩu")}),e.jsxs("div",{className:"col-span-8 sm:col-span-4",children:[e.jsx(B,{register:l,label:"Mật khẩu",name:"password",type:"password",placeholder:"Nhập mật khẩu",required:!0}),e.jsx(C,{errorName:c.password})]})]}),e.jsxs("div",{className:"grid grid-cols-6 gap-3 md:gap-5 xl:gap-6 lg:gap-6 mb-6",children:[e.jsx(k,{label:t("Quyền")}),e.jsxs("div",{className:"col-span-8 sm:col-span-4",children:[u?e.jsx(s.Select,{disabled:!0,children:e.jsx("option",{children:t("Đang tải...")})}):e.jsxs(s.Select,{className:"border h-12 text-sm focus:outline-none block w-full bg-gray-100 dark:bg-white border-transparent focus:bg-white",name:"role",...l("role",{required:"Quyền không được để trống"}),children:[e.jsx("option",{value:"",defaultValue:!0,hidden:!0,children:t("Chọn quyền")}),d.filter(r=>r.name!=="USER").map(r=>e.jsx("option",{value:r.name,children:r.name},r.name))]}),e.jsx(C,{errorName:c.role})]})]})]}),e.jsx(_,{title:"Staff",isSubmitting:p})]})})})})]})},he=({email:t,isActive:l,handleUpdate:n})=>{const{setIsUpdate:i}=o.useContext(M),[c,d]=o.useState(!1),[u,p]=o.useState(!1),r=()=>{p(!0)},j=()=>{p(!1)},y=async()=>{var h,b;try{d(!0);const a=await ne.changeUserStatus(t);i(!0),D(a.message||"Trạng thái tài khoản đã được thay đổi!"),d(!1),j()}catch(a){A(((b=(h=a==null?void 0:a.response)==null?void 0:h.data)==null?void 0:b.message)||(a==null?void 0:a.message)),d(!1),j()}};return e.jsxs("div",{className:"flex",children:[e.jsx("button",{onClick:n,className:"p-2 cursor-pointer text-gray-400 hover:text-emerald-600 focus:outline-none",children:e.jsx(R,{id:"edit",Icon:G,title:v("Thay đổi quyền"),bgColor:"#10B981"})}),e.jsx("button",{onClick:r,className:"p-2 cursor-pointer text-gray-400 hover:text-yellow-600 focus:outline-none",children:l?e.jsx(R,{id:"block",Icon:te,title:v("Block"),bgColor:"#EF4444"}):e.jsx(R,{id:"unlock",Icon:re,title:v("Unlock"),bgColor:"#10B981"})}),e.jsxs(s.Modal,{isOpen:u,onClose:j,children:[e.jsx(s.ModalBody,{className:"text-center custom-modal px-8 pt-6 pb-4",children:e.jsxs("h2",{className:"text-xl font-medium mb-2",children:[l?v("Bạn muốn khóa tài khoản"):v("Bạn muốn mở khóa tài khoản")," ",e.jsx("span",{className:"text-blue-500",children:t}),"?"]})}),e.jsxs(s.ModalFooter,{className:"justify-center",children:[e.jsx(s.Button,{className:"w-full sm:w-auto hover:bg-white hover:border-gray-50",layout:"outline",onClick:j,children:v("Hủy thao tác")}),e.jsx("div",{className:"flex justify-end",children:c?e.jsxs(s.Button,{disabled:!0,type:"button",className:"w-full h-12 sm:w-auto",children:[e.jsx("img",{src:oe,alt:"Loading",width:20,height:10})," ",e.jsx("span",{className:"font-serif ml-2 font-light",children:v("Processing")})]}):e.jsx(s.Button,{onClick:y,className:`w-full h-12 sm:w-auto ${l?"bg-red-500 hover:bg-red-600":"bg-emerald-500 hover:bg-emerald-600"}`,children:l?v("Xác nhận khóa"):v("Xác nhận mở khóa")})})]})]})]})},ge=({isOpen:t,onClose:l,staff:n,showingTranslateValue:i})=>{var c,d;return e.jsxs(s.Modal,{isOpen:t,onClose:l,children:[e.jsxs("h1",{className:"text-xl font-medium text-center pb-6 dark:text-gray-300",children:["List of route access for"," ",e.jsx("span",{className:"text-emerald-600",children:i(n==null?void 0:n.name)})]}),e.jsx(s.ModalBody,{children:((c=n==null?void 0:n.access_list)==null?void 0:c.length)>0?e.jsx("ol",{className:"list-disc pl-5",children:(d=n==null?void 0:n.access_list)==null?void 0:d.map((u,p)=>e.jsx("li",{className:"text-sm text-gray-700 dark:text-gray-300 capitalize",children:u},p))}):e.jsx("p",{className:"text-orange-500 py-10 text-lg text-center",children:"This staff not have any route access!"})}),e.jsx(s.ModalFooter,{className:"justify-end",children:e.jsx(s.Button,{className:"w-full sm:w-auto bg-red-400 text-white hover:bg-red-500",layout:"delete",onClick:l,children:"Close"})})]})},ue={updateUserRole:async(t,l)=>Y.put(`/user/update-role/${t}`,{role:l})},pe=(t,l)=>{const[n,i]=o.useState([]),[c,d]=o.useState(!1),[u,p]=o.useState(!1),{closeDrawer:r,setIsUpdate:j}=o.useContext(M),{register:y,handleSubmit:h,setValue:b,formState:{errors:a}}=H();return o.useEffect(()=>{d(!0),T.getAllRoles().then(g=>{g._embedded&&g._embedded.role&&i(g._embedded.role),d(!1)}).catch(g=>{var m,N;A(((N=(m=g==null?void 0:g.response)==null?void 0:m.data)==null?void 0:N.message)||"Lỗi khi lấy danh sách quyền"),d(!1)})},[]),o.useEffect(()=>{l&&b("role",l)},[l,b]),{register:y,handleSubmit:h,onSubmit:async g=>{var m,N;try{p(!0);const S=await ue.updateUserRole(t,g.role);D(S.message||"Cập nhật quyền cho người dùng thành công"),j(!0),r(),p(!1)}catch(S){A(((N=(m=S==null?void 0:S.response)==null?void 0:m.data)==null?void 0:N.message)||"Lỗi khi cập nhật quyền"),p(!1)}},errors:a,roles:n,loading:c,isSubmitting:u}},je=({staff:t})=>{const{t:l}=F(),{email:n,roleName:i}=t||{},{register:c,handleSubmit:d,onSubmit:u,errors:p,roles:r,loading:j,isSubmitting:y}=pe(n,i);return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-full relative p-6 border-b border-gray-100 bg-gray-50 dark:border-gray-700 dark:bg-gray-800 dark:text-gray-300",children:e.jsx(z,{title:l("Thay đổi quyền"),description:l("Cập nhật quyền cho tài khoản staff")})}),e.jsx(P.Scrollbars,{className:"w-full md:w-7/12 lg:w-8/12 xl:w-8/12 relative dark:bg-gray-700 dark:text-gray-200",children:e.jsx(s.Card,{className:"overflow-y-scroll flex-grow scrollbar-hide w-full max-h-full",children:e.jsx(s.CardBody,{children:e.jsxs("form",{onSubmit:d(u),children:[e.jsxs("div",{className:"px-6 pt-8 flex-grow scrollbar-hide w-full max-h-full pb-40",children:[e.jsxs("div",{className:"grid grid-cols-6 gap-3 md:gap-5 xl:gap-6 lg:gap-6 mb-6",children:[e.jsx(k,{label:l("Email")}),e.jsx("div",{className:"col-span-8 sm:col-span-4",children:e.jsx("p",{className:"block w-full px-4 py-2 text-sm text-gray-700 dark:text-gray-300 bg-gray-100 dark:bg-gray-700 rounded-md",children:n})})]}),e.jsxs("div",{className:"grid grid-cols-6 gap-3 md:gap-5 xl:gap-6 lg:gap-6 mb-6",children:[e.jsx(k,{label:l("Quyền hiện tại")}),e.jsx("div",{className:"col-span-8 sm:col-span-4",children:e.jsx("p",{className:"block w-full px-4 py-2 text-sm font-medium text-gray-700 dark:text-gray-300 bg-gray-100 dark:bg-gray-700 rounded-md",children:i})})]}),e.jsxs("div",{className:"grid grid-cols-6 gap-3 md:gap-5 xl:gap-6 lg:gap-6 mb-6",children:[e.jsx(k,{label:l("Quyền mới")}),e.jsxs("div",{className:"col-span-8 sm:col-span-4",children:[j?e.jsx(s.Select,{disabled:!0,children:e.jsx("option",{children:l("Đang tải...")})}):e.jsx(s.Select,{className:"border h-12 text-sm focus:outline-none block w-full bg-gray-100 dark:bg-white border-transparent focus:bg-white",name:"role",...c("role",{required:"Quyền không được để trống"}),children:r.filter(h=>h.name!=="USER").map(h=>e.jsx("option",{value:h.name,children:h.name},h.name))}),e.jsx(C,{errorName:p.role})]})]})]}),e.jsx(_,{id:!0,title:"Role",isSubmitting:y})]})})})})]})},be=({staffs:t,lang:l})=>{const{title:n,serviceId:i,handleModalOpen:c,handleUpdate:d,isSubmitting:u,handleResetPassword:p}=se(),{showingTranslateValue:r}=J(),{toggleDrawer:j,isDrawerOpen:y}=o.useContext(M),[h,b]=o.useState(null),[a,w]=o.useState(!1),[g,m]=o.useState(!1);o.useEffect(()=>{y||m(!1)},[y]);const N=x=>{b(x),w(!0)},S=()=>{b(null),w(!1)},E=x=>{b(x),m(!0),j()};return e.jsxs(e.Fragment,{children:[e.jsx(ae,{id:i,title:n}),a&&e.jsx(ge,{staff:h,isOpen:a,onClose:S,showingTranslateValue:r}),g&&e.jsx(Z,{children:e.jsx(je,{staff:h})}),e.jsx(s.TableBody,{children:t==null?void 0:t.map(x=>e.jsxs(s.TableRow,{children:[e.jsx(s.TableCell,{children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(s.Avatar,{className:"hidden mr-3 md:block bg-gray-50",src:x.avatar,alt:"staff"}),e.jsx("div",{children:e.jsx("h2",{className:"text-sm font-medium",children:x.fullName})})]})}),e.jsx(s.TableCell,{children:e.jsx("span",{className:"text-sm",children:x.email})}),e.jsx(s.TableCell,{children:e.jsx("span",{className:"text-sm",children:x.phoneNumber||"Chưa cập nhật"})}),e.jsx(s.TableCell,{children:e.jsx("span",{className:"text-sm",children:x.dateOfBirth?K(x.dateOfBirth).format("DD/MM/YYYY"):"Chưa cập nhật"})}),e.jsx(s.TableCell,{children:e.jsx("span",{className:"text-sm font-semibold",children:x.roleName})}),e.jsx(s.TableCell,{className:"text-center text-xs",children:e.jsx("span",{className:`px-2 py-1 rounded ${x.active?"bg-green-500 text-white":"bg-red-500 text-white"}`,children:x.active?"Active":"Blocked"})}),e.jsx(s.TableCell,{children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("button",{onClick:()=>N(x),className:"text-gray-400",children:e.jsx(R,{id:"view",Icon:W,title:"View Access Route",bgColor:"#059669"})}),e.jsx(he,{id:x.id,email:x.email,isActive:x.active,handleUpdate:()=>E(x)})]})})]},x.id))})]})},_e=()=>{var I,U,L,q;o.useContext(X);const{toggleDrawer:t,lang:l,currentPage:n,setCurrentPage:i,setIsUpdate:c,searchText:d,setSearchText:u,isDrawerOpen:p}=o.useContext(M),{t:r}=F(),[j,y]=o.useState("STAFF"),h=o.useRef(null),{data:b,loading:a,error:w}=O(T.getAllRoles),g=async({cancelToken:f})=>T.getAllStaff({page:n,size:5,email:d,roleName:j,cancelToken:f}),{data:m,loading:N,error:S}=O(g);o.useEffect(()=>{u(""),i(1),c(!0)},[u,i,c]);const E=f=>{f.preventDefault();const $=h.current.value;u($),i(1),c(!0)},x=()=>{u(""),y("STAFF"),i(1),c(!0),h.current&&(h.current.value="")},Q=f=>{i(f),c(!0)},V=()=>{t()};return e.jsxs(e.Fragment,{children:[e.jsx(ce,{children:r("Quản lý nhân viên")}),e.jsx(Z,{children:e.jsx(xe,{})}),e.jsx(de,{children:e.jsx(s.Card,{className:"min-w-0 shadow-xs overflow-hidden bg-white dark:bg-gray-800 mb-5",children:e.jsx(s.CardBody,{children:e.jsxs("form",{onSubmit:E,className:"py-3 grid gap-4 lg:gap-6 xl:gap-6 md:flex xl:flex",children:[e.jsx("div",{className:"flex-grow-0 md:flex-grow lg:flex-grow xl:flex-grow",children:e.jsx(s.Input,{ref:h,type:"search",name:"search",placeholder:r("Nhập email nhân viên")})}),e.jsx("div",{className:"flex-grow-0 md:flex-grow lg:flex-grow xl:flex-grow",children:a?e.jsx(s.Select,{disabled:!0,children:e.jsx("option",{children:"Loading..."})}):w?e.jsx("span",{className:"text-red-500",children:w}):e.jsx(s.Select,{value:j,onChange:f=>y(f.target.value),children:(U=(I=b==null?void 0:b._embedded)==null?void 0:I.role)==null?void 0:U.filter(f=>f.name!=="USER").map(f=>e.jsx("option",{value:f.name,children:f.name},f.name))})}),e.jsxs("div",{className:"mt-2 md:mt-0 flex items-center xl:gap-x-4 gap-x-1 flex-grow-0 md:flex-grow lg:flex-grow xl:flex-grow",children:[e.jsx("div",{className:"w-full mx-1",children:e.jsx(s.Button,{type:"submit",className:"h-12 w-full bg-emerald-700",children:"Áp dụng"})}),e.jsx("div",{className:"w-full",children:e.jsx(s.Button,{layout:"outline",onClick:x,type:"reset",className:"px-4 md:py-1 py-3 text-sm dark:bg-gray-700",children:e.jsx("span",{className:"text-black dark:text-gray-200",children:"Hoàn tác"})})})]}),e.jsx("div",{className:"w-full md:w-56 lg:w-56 xl:w-56",children:e.jsxs(s.Button,{onClick:V,className:"w-full rounded-md h-12",children:[e.jsx("span",{className:"mr-3",children:e.jsx(ee,{})}),r("Thêm nhân viên")]})})]})})})}),N?e.jsx(le,{row:12,col:7,width:163,height:20}):S?e.jsx("span",{className:"text-center mx-auto text-red-500",children:S}):((q=(L=m==null?void 0:m.data)==null?void 0:L.content)==null?void 0:q.length)>0?e.jsxs(s.TableContainer,{className:"mb-8 rounded-b-lg",children:[e.jsxs(s.Table,{children:[e.jsx(s.TableHeader,{children:e.jsxs("tr",{children:[e.jsx(s.TableCell,{children:r("Họ tên")}),e.jsx(s.TableCell,{children:r("Email")}),e.jsx(s.TableCell,{children:r("SĐT")}),e.jsx(s.TableCell,{children:r("Ngày sinh")}),e.jsx(s.TableCell,{children:r("ROLE")}),e.jsx(s.TableCell,{className:"text-center",children:r("Trạng thái")}),e.jsx(s.TableCell,{className:"text-center",children:r("Hành động")})]})}),e.jsx(be,{staffs:m.data.content,lang:l})]}),e.jsx(s.TableFooter,{children:e.jsx(s.Pagination,{totalResults:m.data.totalElements,resultsPerPage:m.data.size,onChange:Q,label:"Table navigation"})})]}):e.jsx(ie,{title:"Sorry, There are no staff right now."})]})};export{_e as default};
